{% load static %}
{% load i18n %}
{% load l10n %}
<!DOCTYPE html>
<html lang="en" dir="{% translate 'ltr' %}">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>{% translate 'Dashboard Page' %}</title>

  <link rel="stylesheet" href="{% static 'css/flowbite.css' %}">
  <link rel="stylesheet" href="{% static 'css/tailwind.css' %}">
  <link rel="stylesheet" href="{% static 'css/skelton.css' %}">
  <link rel="stylesheet" href="{% static 'css/star-rate.css' %}">
  <link rel="stylesheet" href="{% static 'css/masonry.css' %}">
  <script src="{% static '/js/jquery.min.js' %}" type="text/javascript"></script>
  <script src="{% static '/js/tailwind.js' %}" type="text/javascript"></script>
  <script src="{% static '/js/jquery.min.js' %}" type="text/javascript"></script>

</head>

<body class="bg-[#FFF4F7]">
  {% include "commons/dashboard_header.html" with pageName="dashboard" type=type %}

  <section class="flex min-h-screen justify-center pt-24 pb-36">
    <div class="container w-9/12">
      <!--**********Skelton start*************-->
    <div id="skeleton-container" >
      <div class="space-y-8">
        <div class="grid grid-cols-12 grid-rows-2 gap-8">
          <div class="box row-start-1 row-end-2 col-start-1 col-end-8">
            <div class="grid grid-cols-3 grid-rows-1 gap-8">
              <div class="bg-white shadow-lg rounded-xl p-3">
                <p class="skeleton skeleton-text"></p>
                <p class="skeleton skeleton-text-span"></p>
                <p class="skeleton skeleton-text__body"></p>
              </div>
              <div class="bg-white shadow-lg rounded-xl p-3">
                <p class="skeleton skeleton-text"></p>
                <p class="skeleton skeleton-text-span"></p>
                <p class="skeleton skeleton-text__body"></p>
              </div>
              <div class="bg-white shadow-lg rounded-xl p-3">
                <p class="skeleton skeleton-text"></p>
                <p class="skeleton skeleton-text-span"></p>
                <p class="skeleton skeleton-text__body"></p>
              </div>
            </div>
          </div>
          <div class="box row-start-2 row-end-2 col-start-1 col-end-8 bg-white shadow-lg rounded-xl p-3">
            <p class="skeleton skeleton-text"></p>
            <p class="skeleton skeleton-text-span"></p>
            <p class="skeleton skeleton-text__body"></p>
          </div>
          <div class="box row-start-1 row-end-3 col-start-8 p-6 col-end-12 bg-white shadow-lg rounded-xl p-3">
            <p class="skeleton skeleton-text"></p>
            <p class="skeleton skeleton-text-span"></p>
            <div class="skeleton skeleton-preview-img"></div>
          </div>
        </div>
        <div class="grid grid-cols-12 grid-rows-2 gap-8">
          <div class="box row-start-1 row-end-3 col-start-1 col-end-5 bg-white rounded-xl shadow-lg p-3">
            <p class="skeleton skeleton-text"></p>
            <p class="skeleton skeleton-text-span"></p>
            <div class="skeleton skeleton-pie-chart"></div>
          </div>
          <div class="box row-start-1 row-end-1 col-start-5 col-end-12">
            <div class="grid grid-cols-3 grid-rows-1 gap-8">
              <div class="bg-white shadow-lg rounded-xl p-3">
                <p class="skeleton skeleton-text"></p>
                <p class="skeleton skeleton-text-span"></p>
                <p class="skeleton skeleton-text__body"></p>
              </div>
              <div class="bg-white shadow-lg rounded-xl p-3">
                <p class="skeleton skeleton-text"></p>
                <p class="skeleton skeleton-text-span"></p>
                <p class="skeleton skeleton-text__body"></p>
              </div>
              <div class="bg-white shadow-lg rounded-xl p-3">
                <p class="skeleton skeleton-text"></p>
                <p class="skeleton skeleton-text-span"></p>
                <p class="skeleton skeleton-text__body"></p>
              </div>
            </div>
          </div>
          <div class="box row-start-2 row-end-3 col-start-5 col-end-12 bg-white shadow-lg rounded-xl p-3">
            <p class="skeleton skeleton-text"></p>
            <p class="skeleton skeleton-text-span"></p>
            <p class="skeleton skeleton-text__body"></p>
          </div>
        </div>
      </div>
    </div>
    <!--**********Skelton End*************-->
    <div id="dashboard-statistic" class="hidden">
      <div class="flex flex-col space-y-8">
        <div class="flex xl:flex-row flex-col xl:space-y-0 space-y-8 ltr:xl:space-x-8">
          <div class="xl:w-4/6 w-full flex flex-col space-y-8">
            <div class="flex md:flex-row flex-col ltr:md:space-x-8 md:space-y-0 space-y-8">
              <div class="flex flex-col flex-1 bg-white shadow-lg rounded-xl p-3">
                <div class="flex flex-col space-y-6">
                  <div>
                    <h4 class="font-bold text-base">{% translate 'Guests sent media'%}</h4>
                    <span class="text-xs text-[#9D9C9C]">{% translate 'How many guests sent media files'%}</span>
                  </div>
                  <div class="flex flex-col items-center">
                    <span id="guests-sent-media" class="font-bold text-[#FF5A82] text-5xl"></span>
                    <span class="text-lg text-[#05B516] font-bold">43%</span>
                  </div>
                </div>
              </div>
              <div class="flex flex-col flex-1 bg-white shadow-lg rounded-xl p-3 rtl:md:mr-8">
                <div class="flex flex-col space-y-6">
                  <div>
                    <h4 class="font-bold text-base">{% translate 'Media received'%}</h4>
                    <span class="text-xs text-[#9D9C9C]">{% translate 'How many photos&videos receiced'%}</span>
                  </div>
                  <div class="flex flex-col items-center">
                    <span id="media-recieved" class="font-bold text-[#FF5A82] text-5xl"></span>
                  </div>
                </div>
              </div>
              <div class="flex flex-col flex-1 bg-white shadow-lg rounded-xl p-3 rtl:md:mr-8">
                <div class="flex flex-col space-y-6">
                  <div>
                    <h4 class="font-bold text-base">{% translate 'Total guests'%}</h4>
                    <span class="text-xs text-[#9D9C9C]">{% translate 'How many guests in your list'%}</span>
                  </div>
                  <div class="flex flex-col items-center">
                    <span id="total-guests" class="font-bold text-[#FF5A82] text-5xl"></span>
                  </div>
                </div>
              </div>
            </div>
            <div class="bg-white shadow-lg rounded-xl p-3">
              <div>
                <h4 class="font-bold text-base">{% translate 'Top senders'%}</h4>
                <span class="text-xs text-[#9D9C9C]">{% translate 'Who are your top media senders'%}</span>
                <div class="h-[300px]">
                  <canvas id="myBarChart"></canvas>
                </div>
              </div>
            </div>
          </div>
          <div class="xl:w-2/6 w-full flex flex-col space-y-6 bg-white shadow-lg rounded-xl p-3 rtl:xl:mr-8">
            <p class="block text-sm font-medium text-gray-900">{% translate 'Preview'%}</p>
            <div class="flex flex-col lg:py-0 py-6 items-center justify-center h-full rounded-xl bg-[url({% static '/images/messgae_bg.jpg' %})] bg-no-repeat bg-cover">
              <div class="flex flex-col space-y-9 w-[80%] bg-white p-6 my-6 rounded-xl">
                <img src="{% static 'images/hero_img.svg' %}" class="rounded-xl" id="event-image-dashboard">
                <p class="text-sm">
                  {% translate 'Lorem Ipsum is simply dummy text of the printing and typesetting industry. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged'%}
                </p>
              </div>
            </div>
          </div>
        </div>
        <div class="flex xl:flex-row flex-col xl:space-y-0 space-y-8 ltr:xl:space-x-8">
          <div class="xl:w-2/6 w-full flex flex-col space-y-6 bg-white shadow-lg rounded-xl p-3">
            <div>
              <h4 class="font-bold text-base">Message sending statistics</h4>
              <span class="text-xs text-[#9D9C9C]">Some statistics about the messages</span>
            </div>
            <div class="h-[270px]">
              <canvas id="myPieChart"></canvas>
            </div>
          </div>
          <div class="xl:w-4/6 w-full flex flex-col space-y-8 rtl:xl:mr-8">
            <div class="flex md:flex-row flex-col ltr:md:space-x-8 md:space-y-0 space-y-8">
              <div class="flex flex-col flex-1 bg-white shadow-lg rounded-xl space-y-6 p-3">
                <div>
                  <h4 class="font-bold text-base">{% translate 'Gallery visits'%}</h4>
                  <span class="text-xs text-[#9D9C9C]">{% translate 'How many visits in your gallery'%}</span>
                </div>
                <div class="flex flex-col items-center">
                  <span id="gallery-visit-stats" class="font-bold text-[#FF5A82] text-5xl">1,123</span>
                </div>
              </div>
              <div class="flex flex-col items-center flex-1 bg-white shadow-lg rounded-xl space-y-6 p-3 rtl:md:mr-8">
                <div class="flex space-x-1 h-24">
                  <a href="https://twitter.com" target="_blank" class="self-end" href="">
                    <img src="{% static 'images/twitter.svg' %}">
                  </a>
                  <a href="https://www.instagram.com/" target="_blank">
                    <img src="{% static 'images/instagram_color.svg' %}">
                  </a>
                  <a href="https://www.facebook.com/" target="_blank">
                    <img src="{% static 'images/facebook_color.svg' %}">
                  </a>
                  <a class="self-end" href="https://web.whatsapp.com/" target="_blank">
                    <img src="{% static 'images/whatsapp-color.svg' %}">
                  </a>
                </div>
                <h3 class="text-xl font-bold text-[#FF5A82] text-center">{% translate 'Share Your Gallery'%}</h3>
              </div>
              <div class="flex flex-col flex-1 items-center space-y-6 bg-white shadow-lg rounded-xl p-3 rtl:md:mr-8">
                <div class="h-24">
                  <img src="{% static 'images/dashbord-gallery.svg' %}">
                </div>
                <a href="/gallery/" class="text-xl font-bold text-[#FF5A82] text-center">{% translate 'Enter Your Gallery'%}</a>
              </div>
            </div>
            <div class="flex flex-col bg-white shadow-lg rounded-xl p-3 items-center min-h-[160px]">
              <div id="refresh-rating" class="mt-3"></div>
              <h3 id="rate-title" class="text-2xl font-bold text-[#FF5A82] mb-6">{% translate 'How are you satisfy with us?'%}</h3>
              <h3 id="rate-subtitle" class="text-xl font-bold text-[#FF5A82] hidden mb-3">{% translate 'We will appreciate if you tell us a bit more'%}</h3>
              <div id="stars_rating">
                <div class="stars">
                  <div class="star">★</div>
                  <div class="star">★</div>
                  <div class="star">★</div>
                  <div class="star">★</div>
                  <div class="star">★</div>
                </div>
              </div>
              <div id="feedback-input" class="relative md:w-2/3 w-full hidden">
                <input type="search" id="feedback-text" class="block p-4 w-full text-sm text-gray-900 rounded-lg border border-gray-300 focus:ring-[#F47E80] focus:border-[#F47E80]" placeholder="{% translate 'Share us with your feedback'%}" required>
                <button id="submit-feedback" type="button" class="text-white absolute ltr:right-2.5 rtl:left-2.5 bottom-2.5 bg-[#FFB4C6] hover:bg-[#F47E80] focus:ring-0 focus:outline-none focus:ring-0 font-medium rounded-lg text-sm px-4 py-2 ">{% translate 'Send'%}</button>
            </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    </div>
  </section>
  <div id="snackbar" class="">{% translate 'Thank you, We appreciate your feedback!'%}</div>
  <script src="{% static '/js/flowbite.js' %}" type="text/javascript"></script>
  <script src="{% static '/js/chart.js' %}" type="text/javascript"></script>
  <script>

   let barChartLabel = [];
   let barChartData = [];
   let pieChartLabel = [];
   let pieChartData = [];

   function getdashboardStatistic() {
      fetch("http://127.0.0.1:8000/static/data/dashboard.json", {
          method: "GET",
          headers: {"access-Control-Allow-Origin": "*"}
        })
        .then((response) => response.json())
        .then((data) => {
          if (data) {
            getChartsInformation(data[0].top_sender, data[0].message_stats);
          }
          $('#skeleton-container').addClass('hidden');
          $('#dashboard-statistic').removeClass('hidden');
          $('#guests-sent-media').text(data[0].guests_sent_media);
          $('#media-recieved').text(data[0].media_recieved);
          $('#total-guests').text(data[0].total_guests);
          $('#gallery-visit-stats').text(data[0].gallery_visit_stats);
        });
    }
    
    setTimeout(function() {
      getdashboardStatistic();
    },2000);

    function getChartsInformation(barArray, pieArray) {
      barArray.forEach(item => {
        if(item && item.sender_name)
          barChartLabel.push(item.sender_name);
          barChartData.push(item.total_media);
      });
      pieArray.forEach(item => {
        if(item && item.label)
          pieChartLabel.push(item.label);
          pieChartData.push(item.value);
      });
    }

    const configPieChart = {
      type: 'pie',
      data: {
        labels: pieChartLabel,
        datasets: [{
          label: 'Messages Statistics',
          data: pieChartData,
          backgroundColor: [
            'rgb(206, 54, 76)',
            'rgb(244, 126, 128)',
            'rgb(53, 188, 199)'
          ],
          hoverOffset: 4
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
      }
    };

    
    const configBarChart = {
      type: 'bar',
      data: {
        labels: barChartLabel,
        datasets: [{
          label: 'Top sender',
          data: barChartData,
          backgroundColor: [
            'rgb(244, 126, 128)'
          ],
          borderColor: [
            'rgb(244, 126, 128)'
          ],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
      scales: {
        y: {
          beginAtZero: true
        },
        yAxis: {
            display: false,
        },
        xAxis: {
            display: false,
        }
      }
    },
    };
    const myPieChart = new Chart(
      document.getElementById('myPieChart'),
      configPieChart
    );
    const myBarChart = new Chart(
      document.getElementById('myBarChart'),
      configBarChart
    );

    /******************Stars Rate***********************/

  let _rating = 0;
  const setRating = num => {
    _rating = num;
  };

  let avg = 3.2;
  let count = 5.0;

  const rounded = (f, n = 2) => {
    let i = 0;
    if (n > 0) {
      i = Math.round(f * Math.pow(10, n));
      return i / Math.pow(10, n);
    }
    return f;
  };

  const stars = document.querySelectorAll('.star');

  $('.star').on('click', function (e) {
    stars.forEach((star, i) => {
      if (star === e.currentTarget) {
        setRating(i + 1);
        if ($('.star.rated').length) {
          $('.star.rated').removeClass('rated');
        }
        e.currentTarget.classList.add('rated');
        $('.stars').addClass('rated');
      }
    });
    $('#rate-title').addClass('hidden');
    $('#stars_rating').addClass('hidden');
    $('#refresh-rating').html(`<img src="{% static 'images/refresh.svg' %}" class="w-24" />`);
    setTimeout(() => {
      sendRateRequest();
    },2000);
  });

  function sendRateRequest() {
    $.ajax({
      url:"http://127.0.0.1:8000/static/data/dashboard.json",
      type:"POST",
      data:{
        message: _rating,
      },
      success:function(response) {
        $('#refresh-rating').html('');
        $('#rate-title').text(`{% translate 'Thank you!'%}`);
        $('#rate-title').removeClass('hidden');
        $('#rate-title').removeClass('mb-6');
        $('#rate-subtitle').removeClass('hidden');
        $('#feedback-input').removeClass('hidden');
      },
      error:function(){
        console.warn("Error when sending message to the server");
      },
    });
  }

  function sendFeedbackRequest(feedbackText) {
    $.ajax({
      url:"http://127.0.0.1:8000/static/data/dashboard.json",
      type:"POST",
      data:{
        message: feedbackText,
      },
      success:function(response) {
        $('#refresh-rating').html('');
        $('#rate-title').text(`{% translate 'How are you satisfy with us?'%}`);
        $('#rate-title').removeClass('hidden');
        $('#rate-title').addClass('mb-6');
        $('#stars_rating').removeClass('hidden');
        $('#rate-subtitle').addClass('hidden');
        $('#feedback-input').addClass('hidden');
        showSnackBar();
      },
      error:function(){
        console.warn("Error when sending message to the server");
      },
    });
  }

  $('#submit-feedback').click(function (e) {
    $('#rate-title, #rate-subtitle').addClass('hidden');
    $('#stars_rating').addClass('hidden');
    $('#feedback-input').addClass('hidden')
    $('#refresh-rating').html(`<img src="{% static 'images/refresh.svg' %}" class="w-24" />`);
    const feedbackText = $('#feedback-text').val();
    setTimeout(() => {
      sendFeedbackRequest(feedbackText);
    },2000);
  });

  $('#clear').click(function () {
    setRating(0);
    $('.rated').removeClass('rated');
  });

  function showSnackBar() {;
  $("#snackbar").addClass( "show" );
  setTimeout(function(){ 
    $("#snackbar").removeClass( "show" );
  }, 2000);
};
  </script>
</body>
</html>